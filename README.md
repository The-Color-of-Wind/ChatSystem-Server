# 实时聊天系统—服务器（**[客户端](https://github.com/The-Color-of-Wind/ChatSystem-Client)**）
---

## 项目介绍
基于 **Epoll + 线程池 + 主从 Reactor 模型** 的高性能通信服务器，支持 **Qt 跨平台客户端**接入，并通过**JMeter**测试，支持 **2000+ 实时通信**，适用于**在线聊天、消息推送**等高并发场景。

---

## 项目特点

### 高并发架构

- **主从 Reactor 模型（多Reacor）**：主线程仅负责监听和连接分发，工作线程异步处理 I/O，有效提升并发处理能力
- **线程池 + 回调任务机制**：线程池采用回调函数形式提交任务，减少执行周期、线程竞争，提升异步处理效率
- **数据库连接池（单例 + RAII）**：单例模式创建并数据库连接池封装，配合 RAII 自动释放资源，避免连接泄漏
- **异步数据库写入**：数据库写入采用任务队列执行，定时或定量统一取出，由专用线程异步处理，避免主流程阻塞

### 异步日志系统

- 基于 **管道通信** + **日志线程** 实现异步日志写入
- 支持**多级日志等级**（INFO, ERROR, DEBUG），避免阻塞主线程 I/O

### 性能压测
- 使用 **JMeter 自定义 TCP Sampler** 进行压力测试
- 已验证可支持 **2000+并发连接** 实时通信，系统稳定运行

---

## 目录
1. [已实现功能](#已实现功能)
2. [Demo演示](#Demo演示)
3. [服务器框架](#服务器框架)
4. [硬件信息](#硬件信息)
5. [项目运行](#项目运行)
6. [更新日志](#更新日志)（QPS优化）
7. [致谢](#致谢)
   
---

## 已实现功能

- ✅ 用户注册与登录
- ✅ 好友添加/删除/列表
- ✅ 实时聊天（点对点）
- ✅ 异步日志记录
- ✅ 数据库连接池支持
- 持续更新中...

---

## Demo演示
[演示视频](https://www.bilibili.com/video/BV1GrosY3E7k/?vd_source=57d3045b67b7aa01f9f207a33b419c6a)

---

## 服务器框架
![55857738ed533bb911103e999148fb0](https://github.com/user-attachments/assets/4978336a-a5e4-41e3-b974-c24102199cfc)
![7b1cca322ae53001663766a33e3e685](https://github.com/user-attachments/assets/5c54e15a-cf95-42ee-b578-963c651635a2)

---

## 硬件信息

- 处理器：4
- 内核：4
- 内存：3.0GB
- 文件描述符限制：100000（ulimit -n）

---

## 项目运行

- 环境：
  - 操作系统：Ubuntu 20.04
  - 数据库：MySQL 8.0.41 （数据库表私聊我）
  - 
- 构建
  - sudo apt-get install g++
  - sudo apt-get install make
  - sudo apt-get install libjsoncpp-dev
  - sudo apt-get install libmysqlclient-dev
  - make
  - ./startserv 12345

- 数据库
  - sql目录下有两个数据库文件，分别是 结构 / 结构+数据，可根据需求选择

---

## 更新日志
### **version1**：
| 指标项 | 2000并发 | 5000并发 | 
|-------|-----------|--------------|
| **请求量** | 4000 | 10000 |
| **登录响应**| 3551ms| 10488ms |
| **登录成功率**| 97.2%| 70.3% |
| **通信响应**| 341ms| 1179ms |
| **通信成功率**| 97.2%| 70.3% |

> *注*：
> - *登录都需要一定的时间初始化，时延差强人意，但成功率太差*
> - *发送信息响应时延表现较好，但成功率不足，且暂无重发机制*

---

## 致谢
Linux高性能服务器编程，游双著.

感谢前辈的项目引路：https://github.com/qinguoyi/TinyWebServer?tab=readme-ov-file
